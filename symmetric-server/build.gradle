apply from: symAssembleDir + '/common.gradle'
apply from: symAssembleDir + '/asciidoc.gradle'

    description = 'SymmetricDS Server library for JDBC client'

    apply plugin: 'distribution'

    dependencies {
        compile project(":symmetric-client")
        compile "org.springframework:spring-jms:$springVersion"
        compile "org.springframework:spring-web:$springVersion"
        compile "org.springframework:spring-webmvc:$springVersion" // This was is ensure that swagger-springmvc picks up the matching Spring version.
        compile "javax.xml.bind:jaxb-api:$jaxbVersion"
        compile "org.jdom:jdom2:$jdomVersion"
        compile ("com.mangofactory:swagger-springmvc:0.6.5") {
            exclude group: 'asm'
        }
        provided project(":symmetric-wrapper")

        provided "javax.jms:jms-api:1.1-rev-1"
        compileOnly "org.codehaus.mojo:animal-sniffer-annotations:$animalSnifferVersion"
        
        provided "javax.servlet:javax.servlet-api:$servletVersion"
        provided "org.eclipse.jetty:jetty-webapp:$jettyVersion"
        provided "javax.websocket:javax.websocket-api:$websocketVersion"
        provided ("org.eclipse.jetty.websocket:javax-websocket-server-impl:$jettyVersion") {
           exclude group: "org.eclipse.jetty", module: "jetty-annotations"
           exclude group: "org.eclipse.jetty", module: "jetty-jmx"
           exclude group: "org.eclipse.jetty", module: "jetty-jndi"
           exclude group: "org.eclipse.jetty", module: "jetty-plus"
           exclude group: "org.ow2.asm"
        }

        testCompile project(path: ':symmetric-util', configuration: 'testArtifacts')
        testCompile project(path: ':symmetric-io', configuration: 'testArtifacts')
        integrationTestCompile project(':symmetric-jdbc').sourceSets.integrationTest.output
        testCompile project(path: ':symmetric-core', configuration: 'testArtifacts')
        integrationTestCompile project(':symmetric-client').sourceSets.integrationTest.output
    }

    distributions {
        server {
            baseName = 'symmetric-server'
            contents {
                from { 'COPYING' }
                from { 'CREDITS' }
                from { 'NOTICE' }
                from ('src/main/deploy') {
                    exclude 'bin/sym'
                    exclude 'bin/symadmin'
                    exclude 'bin/dbexport'
                    exclude 'bin/dbimport'
                    exclude 'bin/dbfill'
                    exclude 'bin/jmx'
                    exclude 'bin/dbsql'
                    exclude 'bin/dbcompare'
                    exclude 'bin/sym_service'
                    exclude 'bin/setenv'
                }
                from ('src/main/deploy') {
                    include 'bin/sym'
                    include 'bin/symadmin'
                    include 'bin/dbexport'
                    include 'bin/dbimport'
                    include 'bin/dbfill'
                    include 'bin/jmx'
                    include 'bin/dbsql'
                    include 'bin/dbcompare'
                    include 'bin/sym_service'
                    include 'bin/setenv'
                    fileMode 0755
                }
                into('doc') { from ("$symAssembleDir/build/doc") }
                into('lib') {
                    from configurations.provided { exclude "*animal-sniffer*" }
                    rename 'symmetric-wrapper(.*).jar', 'symmetric-wrapper.jar'
                }
                into('web/WEB-INF/lib') {
                    from project(":symmetric-server").jar
                    from configurations.compile.filter {  a ->
                                !configurations.provided.contains(a) &&
                                !project(':symmetric-server').configurations.provided.contains(a)
                    }
                }
            }
        }
    }
    
    
    serverDistZip.dependsOn { ':symmetric-server:jar' }
    serverDistZip.dependsOn { ':symmetric-server:generateDocs' }
    generateAppendixes.dependsOn(project(':symmetric-server').jar)